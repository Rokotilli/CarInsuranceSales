# Telegram Bot Documentation

## Setup Instructions and Dependencies

### Requirements

- .NET 7 SDK or higher
- Telegram Bot Token (from [BotFather](https://t.me/BotFather))
- Access keys for:
  - **Mindee API** (for document recognition)
  - **OpenRouter API** (for AI-generated responses)
- Visual Studio / Rider / VS Code (recommended)
- Internet connection

### Dependencies

This project uses the following libraries:

- `Microsoft.Extensions.Configuration`
- `Microsoft.Extensions.Configuration.UserSecrets`
- `Microsoft.Extensions.DependencyInjection`
- `Microsoft.Extensions.Hosting`
- `Microsoft.Extensions.Http`
- `Mindee`
- `Newtonsoft.Json`
- `Serilog`
- `Serilog.Extensions.Hosting`
- `Serilog.Sinks.Console`
- `Serilog.Sinks.File`
- `Telegram.Bot`

### Configuration

In the `appsettings.json` file, set the following parameters:

- `BotToken`: Your Telegram bot token.
- `Messages`: Contains all the prompts for AI that responds to human.
- `Mindee:ApiKey` Your Mindee API key.
- `OpenRouterAPI:Name`: Name of API for http factory.
- `OpenRouterAPI:BaseAdress`: Base URL of API for http requests.
- `OpenRouterAPI:APIKey`: Your OpenRouter API key.

---

## Bot Workflow Description

### 1. **Bot Setup**
   - The bot is initialized using the Telegram Bot API.
   - When a user starts a conversation, the bot introduces itself and explains that its purpose is to assist with car insurance purchases.
  
### 2. **Document Submission**
   - The bot prompts the user to submit a photo of their passport and vehicle identification document (technical passport).
   - The bot explains that these documents are required for generating the insurance proposal.

### 3. **Integration with Mindee API**
   - After the user submits their passport and vehicle identification document, the bot processes the photos.
   - The **Mindee API** is used to extract data from the submitted photos.
   - The bot then displays the extracted data to the user for confirmation. The extracted data includes personal details from the passport and vehicle details from the technical passport.

### 4. **Data Confirmation**
   - If the extracted data is incorrect or incomplete, the user can disagree with the information.
   - The bot will ask the user to retake and resubmit the photo. The data extraction and confirmation process will be repeated.
   - If the user confirms the accuracy of the data, the bot proceeds to the next step.

### 5. **Price Quotation**
   - The bot informs the user that the fixed price for the insurance is 100 USD.
   - It asks the user if they agree with the price.
     - If the user disagrees, the bot apologizes and explains that 100 USD is the only available price.
     - If the user agrees, the bot proceeds to the final step of issuing the insurance policy.

### 6. **Insurance Policy Issuance**
   - Once the user agrees to the price, the bot generates a dummy insurance policy document using a AI-generated content.
   - The bot sends the policy document to the user as confirmation of the insurance purchase.

### 7. **Additional Features**
   - All interactions with the user are processed by AI to simulate intelligent conversational capabilities. This includes understanding the user's intent, extracting the necessary data from images, confirming data, and engaging the user with contextual and conversational responses.
---

## Example Interaction Flows

### `/start` Command

**User:** `/start`  
**Bot:**  
> Hi there! I'm here to help you purchase your car insurance quickly and easily.

To get started, please send us the following documents:
📄 A photo of your passport
🚙 A photo of your vehicle identification document (technical passport)

Once we receive these, we’ll guide you through the next steps! 😊

---

### Sending a Passport Photo

**User:** *(passport photo)*  
**Bot:**  
> Full Name: John Doe  
> Passport Number: AB123456  
> Expiry Date: 2030-12-31  
> Issuing country: UK  
> Personal number: 19910824-00026  
> Sex: Male  
> Nationality: UK  
> Date of birth: 1991-08-24  
> Is this information correct?  
[Yes ✅] [No ❌]

---

### Confirming Passport Information

**User:** *clicks Yes*  
**Bot:**  
> Thank you! Now, please send a photo of your technical passport.

---

### Sending a Technical Passport Photo

**User:** *(technical passport photo)*  
**Bot:**  
> VIN: XYZ987654321  
> License plate: AA1234BC  
> Manufacturer: Toyota  
> Model: Corolla  
> Manufacturing date: 2018  
> Is this information correct?  
[Yes ✅] [No ❌]

---

### Price Quotation

**User:** *clicks Yes*  
**Bot:**  
> The fixed price for your insurance is 100 USD. Do you agree with this price?  
[Yes ✅] [No ❌]

---

### Final Confirmation

**User:** *clicks Yes*  
**Bot:**  
> [Dummy policy generated by AI]

---

## Conclusion

This bot provides a seamless, step-by-step process for document verification and insurance proposal generation, fully powered by AI. It uses the **Mindee API** for document processing and **OpenRouter API** for intelligent conversation handling. All communications are processed by AI to simulate a conversational and personalized user experience.
